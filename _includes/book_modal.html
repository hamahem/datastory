<style>
  /* Modal Overlay */
  .book-modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 9999;
    overflow: auto;
    padding: 20px;
  }

  .book-modal-overlay.active {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Close Button */
  .modal-close {
    position: absolute;
    top: 20px;
    right: 30px;
    font-size: 40px;
    color: white;
    cursor: pointer;
    z-index: 10001;
    transition: transform 0.3s;
  }

  .modal-close:hover {
    transform: scale(1.2);
  }

  /* Book Container */
  .book-modal-container {
    width: 90%;
    max-width: 1200px;
    height: 80vh;
    max-height: 800px;
    position: relative;
    perspective: 2000px;
  }

  /* Page Flip Book */
  .flip-book {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
  }

  .book-page {
    width: 50%;
    height: 100%;
    padding: 40px;
    position: absolute;
    background: #fffef0;
    background-image: linear-gradient(
      to right,
      rgba(0, 0, 0, 0.1) 0%,
      rgba(0, 0, 0, 0) 10%
    );
    transition: transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1);
    transform-origin: left center;
    backface-visibility: hidden;
    overflow-y: auto;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
  }

  .book-page.right {
    left: 50%;
    background-image: linear-gradient(
      to left,
      rgba(0, 0, 0, 0.1) 0%,
      rgba(0, 0, 0, 0) 10%
    );
    transform-origin: right center;
  }

  .book-page.flipped {
    transform: rotateY(-180deg);
    z-index: 1;
  }

  .book-page.right.flipped {
    transform: rotateY(180deg);
  }

  /* Page Content Styling */
  .page-content h2 {
    margin-top: 0;
    color: #333;
    border-bottom: 2px solid #8b4513;
    padding-bottom: 10px;
  }

  .page-content p {
    line-height: 1.8;
    text-align: justify;
    color: #333;
  }

  .page-content img {
    max-width: 100%;
    height: auto;
    margin: 20px 0;
    border-radius: 5px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .page-content .math-expression {
    margin: 20px 0;
    padding: 15px;
    background: #f5f5f5;
    border-left: 4px solid #8b4513;
    font-size: 18px;
    overflow-x: auto;
  }

  .page-content code {
    background: #f5f5f5;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
  }

  /* Navigation */
  .book-navigation {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 20px;
    z-index: 10000;
  }

  .nav-btn {
    background: rgba(139, 69, 19, 0.8);
    color: white;
    border: none;
    padding: 12px 24px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 5px;
    transition: all 0.3s;
  }

  .nav-btn:hover:not(:disabled) {
    background: rgba(139, 69, 19, 1);
    transform: scale(1.05);
  }

  .nav-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .page-indicator {
    background: rgba(255, 255, 255, 0.9);
    padding: 10px 20px;
    border-radius: 5px;
    font-weight: bold;
    color: #333;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .book-modal-container {
      width: 95%;
      height: 90vh;
    }

    .book-page {
      width: 100%;
      padding: 20px;
      font-size: 14px;
    }

    .book-page.right {
      left: 0;
      display: none;
    }

    .page-content h2 {
      font-size: 20px;
    }
  }
</style>

<div id="book-modal" class="book-modal-overlay">
  <span class="modal-close" onclick="closeBookModal()">&times;</span>

  <div class="book-modal-container">
    <div class="flip-book" id="flip-book">
      <!-- Pages will be dynamically inserted here -->
    </div>

    <div class="book-navigation">
      <button class="nav-btn" id="prev-btn" onclick="previousPage()">
        ‚Üê Previous
      </button>
      <span class="page-indicator">
        Page <span id="current-page">1</span> of
        <span id="total-pages">1</span>
      </span>
      <button class="nav-btn" id="next-btn" onclick="nextPage()">
        Next ‚Üí
      </button>
    </div>
  </div>
</div>

<script>
  let currentBook = null;
  let currentPageIndex = 0;
  let totalPages = 0;

  // Book content database
  const bookContents = {
    archives: [
      {
        title: "The Imperial Archives",
        content: `
          <h2>üìú The Imperial Archives</h2>
          <p>The foundation of this analysis is built on multiple datasets spanning over 50 years of NASDAQ history.</p>
          <p>Our archives contain:</p>
          <ul>
            <li><strong>~10,970 listed stocks</strong> (1972-2024)</li>
            <li><strong>17,231 delisted companies</strong> with exit reasons</li>
            <li><strong>96.3% GICS coverage</strong> across 11 sectors</li>
          </ul>
        `,
      },
      {
        title: "Data Collection",
        content: `
          <h2>üìä Data Collection Methods</h2>
          <p>Historical price data collected using <code>yfinance</code> library covering:</p>
          <ul>
            <li>Daily prices and volumes</li>
            <li>Market capitalizations</li>
            <li>Stock splits and adjustments</li>
            <li>Listing and delisting dates</li>
          </ul>
          <p>Additional data sourced from CRSP (WRDS) for comprehensive delisting information.</p>
        `,
      },
    ],
    discovery: [
      {
        title: "Dynasty Discovery",
        content: `
          <h2>üîç Dynasty Discovery</h2>
          <p>Using advanced clustering techniques, we identified distinct market dynasties...</p>
          <div class="math-expression">
            Clustering Score: S = Œ£(w<sub>i</sub> √ó similarity<sub>i</sub>)
          </div>
          <p>Each dynasty represents a group of companies with shared growth patterns and market behaviors.</p>
        `,
      },
      {
        title: "Methodology",
        content: `
          <h2>üßÆ Clustering Methodology</h2>
          <p>Our approach combines multiple techniques:</p>
          <ul>
            <li>Time-series analysis of stock performance</li>
            <li>Sector correlation matrices</li>
            <li>Market cap evolution patterns</li>
          </ul>
          <p>This multi-dimensional approach reveals hidden connections between market leaders.</p>
        `,
      },
    ],
    golden: [
      {
        title: "Golden Ages",
        content: `
          <h2>üëë Golden Ages</h2>
          <p>Every dynasty has its peak - a golden age where market dominance reaches its zenith.</p>
          <p>We analyze these periods through:</p>
          <ul>
            <li>Market capitalization peaks</li>
            <li>Trading volume surges</li>
            <li>Industry influence metrics</li>
          </ul>
        `,
      },
      {
        title: "Peak Performance",
        content: `
          <h2>üìà Peak Performance Analysis</h2>
          <p>Golden ages are characterized by sustained growth and market leadership.</p>
          <p>Key indicators include:</p>
          <ul>
            <li>Return on investment (ROI) > 20%</li>
            <li>Market share dominance</li>
            <li>Innovation leadership</li>
          </ul>
        `,
      },
    ],
    fall: [
      {
        title: "The Fall",
        content: `
          <h2>üìâ The Fall of Dynasties</h2>
          <p>All empires eventually decline. We examine the patterns of market dynasty collapse.</p>
          <p>Common failure modes:</p>
          <ul>
            <li>Bankruptcy (32%)</li>
            <li>Mergers & Acquisitions (28%)</li>
            <li>Regulatory violations (15%)</li>
            <li>Market disruption (25%)</li>
          </ul>
        `,
      },
      {
        title: "Lessons Learned",
        content: `
          <h2>üí° Lessons from the Fallen</h2>
          <p>By studying failed dynasties, we uncover valuable insights for future market analysis.</p>
          <p>Key takeaways:</p>
          <ul>
            <li>Adaptability is crucial for survival</li>
            <li>Market disruption creates opportunities</li>
            <li>Regulatory compliance matters</li>
          </ul>
        `,
      },
    ],
  };

  function openBook(bookId) {
    currentBook = bookId;
    currentPageIndex = 0;
    const pages = bookContents[bookId];
    totalPages = pages.length;

    const modal = document.getElementById("book-modal");
    const flipBook = document.getElementById("flip-book");

    // Clear existing pages
    flipBook.innerHTML = "";

    // Create pages
    pages.forEach((page, index) => {
      const pageDiv = document.createElement("div");
      pageDiv.className = `book-page ${index % 2 === 0 ? "left" : "right"}`;
      pageDiv.innerHTML = `<div class="page-content">${page.content}</div>`;
      pageDiv.setAttribute("data-page", index);
      flipBook.appendChild(pageDiv);
    });

    modal.classList.add("active");
    updateNavigation();
  }

  function closeBookModal() {
    const modal = document.getElementById("book-modal");
    modal.classList.remove("active");
    currentBook = null;
  }

  function nextPage() {
    if (currentPageIndex < totalPages - 1) {
      const currentPage = document.querySelector(
        `[data-page="${currentPageIndex}"]`
      );
      currentPage.classList.add("flipped");
      currentPageIndex++;
      updateNavigation();
    }
  }

  function previousPage() {
    if (currentPageIndex > 0) {
      currentPageIndex--;
      const currentPage = document.querySelector(
        `[data-page="${currentPageIndex}"]`
      );
      currentPage.classList.remove("flipped");
      updateNavigation();
    }
  }

  function updateNavigation() {
    document.getElementById("current-page").textContent = currentPageIndex + 1;
    document.getElementById("total-pages").textContent = totalPages;

    document.getElementById("prev-btn").disabled = currentPageIndex === 0;
    document.getElementById("next-btn").disabled =
      currentPageIndex === totalPages - 1;
  }

  // Keyboard navigation
  document.addEventListener("keydown", (e) => {
    if (currentBook) {
      if (e.key === "ArrowRight") nextPage();
      if (e.key === "ArrowLeft") previousPage();
      if (e.key === "Escape") closeBookModal();
    }
  });

  // Close on outside click
  document
    .getElementById("book-modal")
    .addEventListener("click", function (e) {
      if (e.target === this) closeBookModal();
    });
</script>
