<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
<script src="assets/data/window_bias_data.js"></script>
<link
  href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap"
  rel="stylesheet"
/>

<div id="win-viz-wrapper">
  <style>
    #win-viz-wrapper {
      --wb-bg: #f8fafc;
      --wb-text: #1b202b;
      --wb-muted: #6b7280;
      --wb-border: #e2e8f0;
      --wb-accent: #66101f;
      --wb-green: #10b981;
      --wb-red: #ef4444;

      font-family: "Inter", -apple-system, sans-serif;
      width: 100%;
      box-sizing: border-box;
      color: var(--wb-text);
      margin: 2rem auto;
      max-width: 1000px;
    }

    #win-viz-wrapper * {
      box-sizing: border-box;
    }

    /* --- MAIN FRAME --- */
    #win-viz-wrapper .main-frame {
      background-color: #f8fafc;
      overflow: hidden;
      margin-top: 20px;
      margin-bottom: 20px;
    }

    /* --- MAIN CHART --- */
    #win-viz-wrapper .chart-section {
      background: #f8fafc;
      padding: 20px;
    }
    #win-viz-wrapper #main-chart {
      width: 100%;
      height: 450px;
    }
  </style>

  <div class="main-frame">
    <div class="chart-section">
      <div id="main-chart"></div>
    </div>
  </div>
</div>

<script>
  (function () {
    // Scoped
    let wb_data =
      typeof window_bias_data !== "undefined" ? window_bias_data : null;
    let mainChart = null;

    function init() {
      if (!wb_data) {
        setTimeout(() => {
          wb_data =
            typeof window_bias_data !== "undefined" ? window_bias_data : null;
          init();
        }, 200);
        return;
      }

      renderMainChart();

      window.addEventListener("resize", () => {
        if (mainChart) mainChart.resize();
      });
    }

    function renderMainChart() {
      mainChart = echarts.init(document.getElementById("main-chart"));

      const option = {
        tooltip: {
          trigger: "axis",
          backgroundColor: "rgba(255, 255, 255, 0.95)",
          textStyle: { color: "#1b202b" },
          extraCssText: "box-shadow: 0 4px 12px rgba(0,0,0,0.1);",
          formatter: function (params) {
            const idx = params[0].dataIndex;
            return (
              `<div style="font-weight:600; margin-bottom:4px;">Window ${wb_data.windows[idx]}</div>` +
              `Mean ΔMC: <b>${wb_data.mean_delta_mc[idx].toFixed(
                4
              )}T</b><br/>` +
              `Transitions: ${wb_data.n_moves[idx]}`
            );
          },
        },
        grid: {
          left: "5%",
          right: "3%",
          bottom: "10%",
          top: "10%",
          containLabel: true,
        },
        xAxis: {
          type: "category",
          data: wb_data.windows,
          axisLabel: { rotate: 45, color: "#64748b", fontSize: 10 },
          axisLine: { lineStyle: { color: "#e2e8f0" } },
        },
        yAxis: {
          type: "value",
          name: "Mean ΔMC (T)",
          splitLine: { lineStyle: { type: "dashed", color: "#f1f5f9" } },
          axisLabel: { color: "#64748b" },
        },
        series: [
          {
            type: "line",
            data: wb_data.mean_delta_mc,
            symbol: "circle",
            symbolSize: 6,
            lineStyle: { width: 2 },
            itemStyle: {
              color: (p) => (p.data >= 0 ? "#10B981" : "#EF4444"),
            },
            // Removed areaStyle as requested
            markLine: {
              silent: true,
              symbol: "none",
              data: [
                { yAxis: 0, lineStyle: { color: "#333", type: "dashed" } },
              ],
            },
          },
        ],
      };
      mainChart.setOption(option);
    }

    init();
  })();
</script>
